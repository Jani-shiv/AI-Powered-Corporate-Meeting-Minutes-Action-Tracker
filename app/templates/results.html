{% extends "base.html" %}

{% block title %}Meeting Results - CorpMeet-AI{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 animate-fade-in">
    <div>
        <h1 class="h2 fw-bold text-gradient">{{ meeting.title }}</h1>
        <p class="text-muted"><i class="bi bi-calendar3 me-2"></i>Processed on {{ meeting.date_created.strftime('%B %d, %Y at %I:%M %p') }}</p>
    </div>
    <div>
        <a href="{{ url_for('main.export_pdf', meeting_id=meeting.id) }}" class="btn btn-outline-light btn-sm rounded-pill px-3">
            <i class="bi bi-download me-2"></i>Export PDF
        </a>
    </div>
</div>

<div class="row g-4">
    <!-- Left Column: Insights -->
    <div class="col-lg-8">
        <!-- Summary Section -->
        <div class="glass-card p-4 mb-4 animate-fade-in">
            <h3 class="h5 mb-3 text-secondary border-bottom border-secondary pb-2">Executive Summary</h3>
            <ul class="list-unstyled">
                {% for point in meeting.get_summary() %}
                    <li class="mb-3 d-flex align-items-start">
                        <i class="bi bi-check2-circle text-primary me-3 mt-1 fs-5"></i>
                        <span class="lh-base">{{ point }}</span>
                    </li>
                {% else %}
                    <li class="text-muted">No summary available.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Action Items (Cards) -->
        <div class="mb-4 animate-fade-in delay-100">
            <h3 class="h5 mb-3 text-secondary">Action Items <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill ms-2">{{ meeting.get_action_items()|length }}</span></h3>
            <div class="row gx-3">
                {% for item in meeting.get_action_items() %}
                <div class="col-md-6 mb-3">
                    <div class="glass-card p-3 h-100 border-start border-4 border-primary">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="badge bg-secondary bg-opacity-25 text-white">{{ item.owner }}</span>
                            <small class="text-muted"><i class="bi bi-clock me-1"></i>{{ item.deadline }}</small>
                        </div>
                        <p class="mb-0 fw-medium">{{ item.task }}</p>
                    </div>
                </div>
                {% else %}
                    <p class="text-muted ms-2">No action items detected.</p>
                {% endfor %}
            </div>
        </div>

        <!-- Decisions -->
        <div class="glass-card p-4 mb-4 animate-fade-in delay-200">
            <h3 class="h5 mb-3 text-secondary border-bottom border-secondary pb-2">Key Decisions</h3>
            <ul class="list-group list-group-flush bg-transparent">
                {% for decision in meeting.get_decisions() %}
                    <li class="list-group-item bg-transparent text-light border-secondary ps-0">
                        <i class="bi bi-check-square-fill text-success me-2"></i> {{ decision }}
                    </li>
                {% else %}
                    <li class="list-group-item bg-transparent text-muted">No decisions recorded.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Right Column: Analytics & Chat -->
    <div class="col-lg-4">
        <!-- Sentiment & Keywords -->
        <div class="glass-card p-4 mb-4 animate-fade-in delay-100">
            <h4 class="h6 text-uppercase text-muted letter-spacing-1 mb-3">Meeting Analytics</h4>
            
            <div class="mb-4 text-center">
                <h1 class="display-4 fw-bold {% if meeting.sentiment == 'Positive' %}text-success{% elif meeting.sentiment == 'Negative' %}text-danger{% else %}text-warning{% endif %}">
                    {{ meeting.sentiment or 'Neutral' }}
                </h1>
                <p class="text-muted small">Overall Sentiment</p>
            </div>

            <div class="d-flex flex-wrap gap-2 justify-content-center">
                {% for kw in meeting.get_keywords() %}
                    <span class="badge rounded-pill bg-light bg-opacity-10 text-light border border-secondary fw-normal px-3 py-2">#{{ kw }}</span>
                {% endfor %}
            </div>
        </div>

        <!-- AI Chat Interface -->
        <div class="glass-card p-0 d-flex flex-column animate-fade-in delay-200 position-sticky shadow-lg" style="top: 100px; height: 500px;">
            <div class="p-3 border-bottom border-secondary bg-dark bg-opacity-50">
                <h5 class="mb-0 fw-bold"><i class="bi bi-stars text-warning me-2"></i>Ask AI Assistant</h5>
            </div>
            
            <div class="chat-container flex-grow-1 p-3" id="chatBox">
                <div class="chat-message chat-bot">
                    <p class="mb-0 small">Hello! I've analyzed this meeting. Ask me anything about what was discussed.</p>
                </div>
            </div>

            <div class="p-3 border-top border-secondary bg-dark bg-opacity-50">
                <div class="input-group">
                    <input type="text" id="chatInput" class="form-control bg-transparent text-light border-secondary" placeholder="Ask a question..." onkeypress="handleEnter(event)">
                    <button class="btn btn-primary" onclick="sendMessage()"><i class="bi bi-send-fill"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row g-3 mt-5 text-center">
    <div class="col-md-4">
        <a href="{{ url_for('main.export_pdf', meeting_id=meeting.id) }}" class="text-decoration-none">
            <div class="text-danger"><i class="bi bi-file-earmark-pdf" style="font-size: 2rem;"></i></div>
            <strong>Download PDF</strong>
        </a>
    </div>
    <div class="col-md-4">
        <a href="{{ url_for('main.past_meetings') }}" class="text-decoration-none">
            <div class="text-info"><i class="bi bi-clock-history" style="font-size: 2rem;"></i></div>
            <strong>View All Meetings</strong>
        </a>
    </div>
    <div class="col-md-4">
        <a href="{{ url_for('main.upload_page') }}" class="text-decoration-none">
            <div class="text-success"><i class="bi bi-plus-circle" style="font-size: 2rem;"></i></div>
            <strong>Process Another</strong>
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Set meeting ID for the chat functionality in app.js
    window.meetingId = {{ meeting.id }};
</script>
{% endblock %}